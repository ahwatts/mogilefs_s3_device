#!/usr/bin/env ruby

# Capture the Unicorn config file parameter and set it to a default here.
rackup = File.expand_path("../../config.ru", __FILE__)
unicorn_config = "/etc/mogilefs/mogilefs_s3_device_unicorn.rb"
unicorn_args = []

loop do
  arg = ARGV.shift
  if arg == "-c" || arg == "--config-file"
    unicorn_config = ARGV.shift
  elsif arg.nil?
    break
  else
    unicorn_args.push arg
  end
end

# Run unicorn with the remainder of the arguments.
command_line = "unicorn -c #{unicorn_config} #{unicorn_args.join(' ')} #{rackup}"
$stderr.puts "+ #{command_line}"
exec command_line
